// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id        Int      @id @default(autoincrement())
  name      String   // Company name
  slug      String   @unique // URL-friendly identifier
  
  // Subscription fields
  subscriptionTier     String    @default("FREE") // FREE, PRO, ENTERPRISE
  stripeCustomerId     String?   @unique
  stripeSubscriptionId String?   @unique
  subscriptionStatus   String    @default("active") // active, trialing, canceled, past_due
  currentPeriodEnd     DateTime?
  
  users     User[]
  assets    Asset[]
  tickets   Ticket[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id             Int          @id @default(autoincrement())
  name           String
  email          String       @unique
  password       String       // Hashed password
  role           String       @default("EMPLOYEE") // ADMIN or EMPLOYEE
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id])
  tickets        Ticket[]
  createdAt      DateTime     @default(now())
}

model Asset {
  id             Int          @id @default(autoincrement())
  name           String       // E.g: Dell XPS Laptop
  serialNumber   String       @unique
  type           String       // E.g: Laptop, Phone, Tablet
  status         String       @default("OPERATIONAL") // OPERATIONAL, REPAIR, LOST
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id])
  tickets        Ticket[]
}

model Ticket {
  id             Int          @id @default(autoincrement())
  title          String
  description    String
  status         String       @default("OPEN") // OPEN, CLOSED
  priority       String       @default("MEDIUM") // LOW, MEDIUM, HIGH
  organizationId Int
  organization   Organization @relation(fields: [organizationId], references: [id])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  // Relations
  userId      Int
  user        User     @relation(fields: [userId], references: [id])
  assetId     Int
  asset       Asset    @relation(fields: [assetId], references: [id])
}